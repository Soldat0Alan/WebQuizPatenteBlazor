@using Patente
@using System.Linq
@using System.Globalization;
@rendermode InteractiveServer

        <div class="card container p-3 mx-auto justify-content-center container-fluid " style="width:1920px; height:720px; position: relative; ">
            
            @if(_indice < domandeSchedaQuiz.Count){
                
                <div class="progress mb-4">
                    <div class="progress-bar progress-bar-striped bg-success" role="progressbar" style="width: @_lunghezzaBarraAvanzamento.ToString(CultureInfo.InvariantCulture)%" aria-valuenow="@_lunghezzaBarraAvanzamento.ToString(CultureInfo.InvariantCulture)" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <div class="row">
                    <div class="col">
                        <img src="/images/@(domandeSchedaQuiz[_indice].Immagine).gif" class="card card-img-top" alt="Immagine quiz">                
                    </div>

                    <div class=" col">
                        <div class="btn-group w-100 mb-2">
                            <button type="button" class="btn btn-outline-secondary" @onclick="() => CambiaRangeQuiz(RangeQuiz.Uno_Dieci)">1-10</button>
                            <button type="button" class="btn btn-outline-secondary" @onclick="() => CambiaRangeQuiz(RangeQuiz.Undici_Venti)">11-20</button>
                            <button type="button" class="btn btn-outline-secondary" @onclick="() => CambiaRangeQuiz(RangeQuiz.Ventuno_Trenta)">21-30</button>
                        </div>
                       
                        <div class="btn-toolbar mb-3 d-flex justify-content-center" role="toolbar">
                            <div class="btn-group me-2" role="group">
                                @for(int i=0; i<10;i++)
                                {
                                    <button type="button" class="btn btn-outline-secondary" @onclick="() => VaiADomandaSpecifica(i+numDomandaIniziale)">@(numDomandaIniziale+i)</button>
                                }
                            </div>
                        </div>
                        <h5 class="card-title text-center ">Domanda @(_indice + 1) di @domandeSchedaQuiz.Count</h5>
                        <div class="card-body">     
                            <p class="card-text text-center">@domandeSchedaQuiz[_indice].DomandaQuiz</p>
                           <div class="d-flex justify-content-center gap-3" style="position: absolute; bottom: 200px; left: 65%;">
                                <button class="p-0 border-0 bg-transparent "  @onclick="() => TornaAlPrecedente()"><i class="bi bi-arrow-left fs-3"></i></button>
                                <button class="btn btn-success btn-lg px-4 " @onclick="() => VaiAlProssimo()">Vero</button>
                                <button class="btn btn-danger btn-lg px-4" @onclick="() => VaiAlProssimo()">Falso</button>
                                <button class="p-0 border-0 bg-transparent" @onclick="() => VaiAlProssimo()"><i class="bi bi-arrow-right fs-3"></i></button>
                            </div>      
                    </div>
                </div>
                </div>                
            }
        </div>

@code {

    [Parameter] public int IdCapitolo { get; set; }
    [Parameter] public List<Domanda> ListaDomande { get; set; }
    [Parameter] public List<Suggerimento> listaSuggerimenti { get; set; }
    private List<Domanda> domandeSchedaQuiz = new List<Domanda>();
    private List<Suggerimento> suggerimentiCorrenti;
    private int _indice = 0;
    private decimal _lunghezzaBarraAvanzamento ;
    RangeQuiz rangeQuizAttuale= RangeQuiz.Uno_Dieci;
    int numDomandaIniziale =1;
    protected override void OnParametersSet()
    {
        IEnumerable<Domanda>? tutteDomandeCapitolo = ListaDomande.Where(d => d.Id_Capitolo == IdCapitolo);

        domandeSchedaQuiz = tutteDomandeCapitolo.OrderBy(x => Guid.NewGuid()).Take(30).ToList();
        _indice = 0;
    }

    public void VaiAlProssimo()
    {
        if(_indice<=29)
        {
            _indice +=1;
            _lunghezzaBarraAvanzamento  += 3.33m;
        }
    }

    public void TornaAlPrecedente()
    {
        if(_indice>=1)
        {
            _indice -=1;
            _lunghezzaBarraAvanzamento  -= 3.33m;
        }
    }

    public void VaiADomandaSpecifica(int i)
    {
        //Console.WriteLine(numDomandaIniziale);
        Console.WriteLine(i);
        _indice = i-1-10;
        Console.WriteLine(_indice);
    }

    public void CambiaRangeQuiz(RangeQuiz rangeQuiz)
    {
        rangeQuizAttuale = rangeQuiz;
        if(rangeQuiz == RangeQuiz.Uno_Dieci)
        {
            numDomandaIniziale=1;
        }else if(rangeQuiz == RangeQuiz.Undici_Venti)
        {
            numDomandaIniziale=11;
        }else if(rangeQuiz == RangeQuiz.Ventuno_Trenta)
        {
            numDomandaIniziale=21;
        }
    }
}